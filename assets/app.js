var app=angular.module("app",["ngRoute"]);angular.module("app").controller("ApplicationCtrl",["$rootScope","$scope","$http","UserSvc",function(e,o,t,n){window.localStorage.token&&(console.log("Remembering",window.localStorage.token),t.defaults.headers.common["X-Auth"]=window.localStorage.token,n.getUser(),o.currentUser={username:window.localStorage.currentUser}),o.$on("logout",function(e){delete o.currentUser}),o.$on("login",function(e,t){o.currentUser=t})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(e,o){e.login=function(t,n){o.login(t,n).then(function(o){e.$emit("login",o.data)})}}]),angular.module("app").controller("LogoutCtrl",["$scope","UserSvc",function(e,o){o.logout(),e.$emit("logout")}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,o){e.register=function(t,n,r){console.log("register form"),o.createUser(t,n,r).then(function(o){e.login(t,n)})},e.login=function(t,n){o.login(t,n).then(function(o){e.$emit("login",o.data)})}}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"LogoutCtrl",templateUrl:"logout.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"})}]),angular.module("app").service("UserSvc",["$http",function(e){var o=this;o.createUser=function(o,t,n){return e.post("/api/users",{username:o,password:t,emailAddress:n})},o.getUser=function(){return e.get("/api/users").success(function(e){window.localStorage.currentUser=e.username})},o.login=function(t,n){return e.post("/api/sessions",{username:t,password:n}).then(function(t){return o.token=t.data,e.defaults.headers.common["X-Auth"]=t.data,window.localStorage.token=t.data,o.getUser()})},o.logout=function(){console.log("User Service logging out."),delete e.defaults.headers.common["X-Auth"],delete window.localStorage.token}}]);